services:
  vecinita-app:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: vecinita-app:latest
    container_name: vecinita-app
    ports:
      - "8000:8000"
    environment:
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_KEY: ${SUPABASE_KEY}
      DATABASE_URL: ${DATABASE_URL}
      GROQ_API_KEY: ${GROQ_API_KEY}
      OPEN_API_KEY: ${OPEN_API_KEY}
      LANGSMITH_TRACING: ${LANGSMITH_TRACING}
      LANGSMITH_ENDPOINT: ${LANGSMITH_ENDPOINT}
      LANGSMITH_API_KEY: ${LANGSMITH_API_KEY}
      LANGSMITH_PROJECT: ${LANGSMITH_PROJECT}
      EMBEDDING_MODEL: ${EMBEDDING_MODEL}
      USE_LOCAL_EMBEDDINGS: ${USE_LOCAL_EMBEDDINGS}
      OLLAMA_BASE_URL: ${OLLAMA_BASE_URL}
      OLLAMA_MODEL: ${OLLAMA_MODEL}
      TF_ENABLE_ONEDNN_OPTS: "0"
      PORT: "8000"
      PYTHONUNBUFFERED: "1"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://localhost:8000/health" ]
      interval: 30s
      timeout: 5s
      retries: 5

  frontend:
    build:
      context: ./frontend
    image: vecinita-frontend:latest
    container_name: vecinita-frontend
    depends_on:
      - vecinita-app
    environment:
      VITE_BACKEND_URL: "http://vecinita-app:8000"
    ports:
      - "3000:80"

# Optional: define a network (Docker creates a default bridge network)
# networks:
#   default:
#     name: vecinita-net
